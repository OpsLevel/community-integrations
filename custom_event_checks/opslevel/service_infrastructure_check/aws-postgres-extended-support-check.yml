---
version: 1
kind: generic
spec:
  name: AWS Postgres Extended Support Check
  serviceSelector: ".[] | .aliases[0]"
  successCondition: '[.[] | select(.name == $ctx.alias) | .relatedResources.nodes[]
    | select(.type == "Database") | select(.rawData.engine == "aurora-postgresql")
    | (.rawData.engine_version | tonumber) >= 12 ] | all'
  message: "{% if check.passed %}\n  ### Check passed\n  \U0001F389 Congratulations!
    All postgres databases linked to this service are running version 12 or newer.\n{%
    else %}\n  ### Check failed\n  Service **{{ ctx.alias }}** has postgres databases
    running on version 11 or older.  These databases need to be upgraded.\n\n  {%-
    assign resources = data | where: \"name\", ctx.alias  %}\n  {% for resource in
    resources %}\n  {% assign dbs = resource.relatedResources.nodes | where: \"type\",
    \"Database\" %}\n  {% for db in dbs %}\n  {% assign pg_db = db.rawData | where:
    \"engine\", \"aurora-postgresql\" | first %}\n  {% if pg_db %}\n  {% assign engine_version
    = pg_db.engine_version | plus:0 %}\n  {% if engine_version < 12 %}\n  * {{ pg_db.db_instance_identifier
    }} - {{ pg_db.engine_version }}\n  {% endif %}\n  {% endif %}\n  {% endfor %}\n
    \ {% endfor %}\n{% endif %}\n"
  samplePayload: '[{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS85ODQwNA","name":"shopping-cart","aliases":["shopping-cart","shopping-cart-dev","shopping-cart-production","shopping-cart-qa"],"relatedResources":{"nodes":[{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3MDE","href":"/catalog/infrastructure/1057701","name":"shopping-cart-dev-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-dev-1","type":"db_instance","engine":"aurora-postgresql","db_name":"shopping_cart","endpoint":{"port":5432,"address":"shopping-cart-dev-1.ck8i1mnqeulo.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"dev"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"},{"key":"Name","value":"shopping-cart-dev-1"}],"kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"11.21","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-dev-1","db_subnet_group":{"vpc_id":"vpc-0b28432c3a2a8bcc2","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0e01fd24af2db80b7","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0d56d3c9c73f08ac4","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-04e8659eceb5a4362","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"shopping-cart-dev-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster shopping-cart-dev"},"dbi_resource_id":"db-7AYPQ2KLYUWJ4DS6AIUAY3LWKY","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1b","db_instance_class":"db.t4g.medium","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::987654321234:role/rds-enhanced-monitoring-shopping-cart-dev","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-087d723a9520e0b68"}],"dedicated_log_volume":false,"instance_create_time":"2023-12-04T20:09:47.513000Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"shopping-cart-dev","db_instance_identifier":"shopping-cart-dev-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:987654321234:log-group:RDSOSMetrics:log-stream:db-7AYPQ2KLYUWJ4DS6AIUAY3LWKY","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3Mjg","href":"/catalog/infrastructure/1057728","name":"shopping_cart_delivery_status_dev","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:987654321234:table/shopping_cart_delivery_status_dev","type":"db_instance","region":"us-east-1","table_id":"6eae03ed-3bcb-47e9-b78a-a3bc5d2f72a8","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"dev"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"}],"table_arn":"arn:aws:dynamodb:us-east-1:987654321234:table/shopping_cart_delivery_status_dev","item_count":354,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"shopping_cart_delivery_status_dev","table_status":"ACTIVE","table_size_bytes":163980,"creation_date_time":"2022-06-14T21:44:37.960999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":5,"write_capacity_units":5,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3Mjk","href":"/catalog/infrastructure/1057729","name":"shopping_cart_delivery_status_qa","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:987654321234:table/shopping_cart_delivery_status_qa","type":"db_instance","region":"us-east-1","table_id":"93fc3c1b-4117-4eb4-89e9-9983299c990e","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"qa"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"}],"table_arn":"arn:aws:dynamodb:us-east-1:987654321234:table/shopping_cart_delivery_status_qa","item_count":2106,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"shopping_cart_delivery_status_qa","table_status":"ACTIVE","table_size_bytes":939617,"creation_date_time":"2022-06-14T21:48:50.858999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":5,"write_capacity_units":5,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc0MTY","href":"/catalog/infrastructure/1897416","name":"shopping-cart-production-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:534832178741:db:shopping-cart-production-1","type":"db_instance","engine":"aurora-postgresql","db_name":"shopping_cart","endpoint":{"port":5432,"address":"shopping-cart-production-1.crzttm68ambj.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"},{"key":"Name","value":"shopping-cart-production-1"}],"kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"11.21","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:534832178741:db:shopping-cart-production-1","db_subnet_group":{"vpc_id":"vpc-034eafe32072f52df","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-023bad4e8320252e8","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-067cbf2f7375865bc","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0ef78f3701c2d4a13","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"shopping-cart-production-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster shopping-cart-production"},"dbi_resource_id":"db-R6NQ25N3I2FRDDO7CUMUGHQ7XM","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1b","db_instance_class":"db.r6g.xlarge","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::534832178741:role/rds-enhanced-monitoring-shopping-cart-production","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-018e00dcbb693e39b"}],"dedicated_log_volume":false,"instance_create_time":"2020-11-12T19:07:48.539999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"shopping-cart-production","db_instance_identifier":"shopping-cart-production-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":true,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:534832178741:log-group:RDSOSMetrics:log-stream:db-R6NQ25N3I2FRDDO7CUMUGHQ7XM","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[],"performance_insights_retention_period":7},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc0MTg","href":"/catalog/infrastructure/1897418","name":"shopping-cart-production-2","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:534832178741:db:shopping-cart-production-2","type":"db_instance","engine":"aurora-postgresql","db_name":"shopping_cart","endpoint":{"port":5432,"address":"shopping-cart-production-2.crzttm68ambj.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"},{"key":"Name","value":"shopping-cart-production-2"}],"kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"11.21","promotion_tier":2,"db_instance_arn":"arn:aws:rds:us-east-1:534832178741:db:shopping-cart-production-2","db_subnet_group":{"vpc_id":"vpc-034eafe32072f52df","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-023bad4e8320252e8","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-067cbf2f7375865bc","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0ef78f3701c2d4a13","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"shopping-cart-production-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster shopping-cart-production"},"dbi_resource_id":"db-FVQ7CQ4L4KWDILKPHIVYIJRGW4","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1c","db_instance_class":"db.r6g.xlarge","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::534832178741:role/rds-enhanced-monitoring-shopping-cart-production","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-018e00dcbb693e39b"}],"dedicated_log_volume":false,"instance_create_time":"2020-11-12T18:59:02.134999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"shopping-cart-production","db_instance_identifier":"shopping-cart-production-2","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":true,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:534832178741:log-group:RDSOSMetrics:log-stream:db-FVQ7CQ4L4KWDILKPHIVYIJRGW4","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[],"performance_insights_retention_period":7},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc1Njk","href":"/catalog/infrastructure/1897569","name":"shopping_cart_delivery_status_production","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:534832178741:table/shopping_cart_delivery_status_production","type":"db_instance","region":"us-east-1","table_id":"6494fa8e-384c-4a09-84b9-cba150f71851","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"}],"table_arn":"arn:aws:dynamodb:us-east-1:534832178741:table/shopping_cart_delivery_status_production","item_count":13689848,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"shopping_cart_delivery_status_production","table_status":"ACTIVE","table_size_bytes":6099950005,"creation_date_time":"2022-07-27T13:49:45.273999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":10,"write_capacity_units":10,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3MDc","href":"/catalog/infrastructure/1057707","name":"shopping-cart-qa-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-qa-1","type":"db_instance","engine":"aurora-postgresql","db_name":"shopping_cart","endpoint":{"port":5432,"address":"shopping-cart-qa-1.ck8i1mnqeulo.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"qa"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"shopping-cart"},{"key":"Name","value":"shopping-cart-qa-1"}],"kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"11.21","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-qa-1","db_subnet_group":{"vpc_id":"vpc-0b28432c3a2a8bcc2","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0e01fd24af2db80b7","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0d56d3c9c73f08ac4","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-04e8659eceb5a4362","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"shopping-cart-qa-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster shopping-cart-qa"},"dbi_resource_id":"db-G74VR43FATYYWNRXFABLQUQMYY","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1a","db_instance_class":"db.t4g.medium","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::987654321234:role/rds-enhanced-monitoring-shopping-cart-qa","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-041077de84466ebd7"}],"dedicated_log_volume":false,"instance_create_time":"2023-12-04T20:09:22.687999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"shopping-cart-qa","db_instance_identifier":"shopping-cart-qa-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:987654321234:log-group:RDSOSMetrics:log-stream:db-G74VR43FATYYWNRXFABLQUQMYY","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"}]}},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS85ODQwNA","name":"catalog-service","aliases":["catalog-service","catalog-service-dev","catalog-service-production","catalog-service-qa"],"relatedResources":{"nodes":[{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3MDE","href":"/catalog/infrastructure/1057701","name":"catalog-service-dev-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-dev-1","type":"db_instance","engine":"aurora-postgresql","db_name":"catalog_service","endpoint":{"port":5432,"address":"catalog-service-dev-1.ck8i1mnqeulo.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"dev"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"},{"key":"Name","value":"catalog-service-dev-1"}],"kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"12.01","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-dev-1","db_subnet_group":{"vpc_id":"vpc-0b28432c3a2a8bcc2","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0e01fd24af2db80b7","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0d56d3c9c73f08ac4","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-04e8659eceb5a4362","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"catalog-service-dev-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster catalog-service-dev"},"dbi_resource_id":"db-7AYPQ2KLYUWJ4DS6AIUAY3LWKY","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1b","db_instance_class":"db.t4g.medium","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::987654321234:role/rds-enhanced-monitoring-catalog-service-dev","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-087d723a9520e0b68"}],"dedicated_log_volume":false,"instance_create_time":"2023-12-04T20:09:47.513000Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"catalog-service-dev","db_instance_identifier":"catalog-service-dev-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:987654321234:log-group:RDSOSMetrics:log-stream:db-7AYPQ2KLYUWJ4DS6AIUAY3LWKY","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3Mjg","href":"/catalog/infrastructure/1057728","name":"catalog_service_delivery_status_dev","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:987654321234:table/catalog_service_delivery_status_dev","type":"db_instance","region":"us-east-1","table_id":"6eae03ed-3bcb-47e9-b78a-a3bc5d2f72a8","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"dev"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"}],"table_arn":"arn:aws:dynamodb:us-east-1:987654321234:table/catalog_service_delivery_status_dev","item_count":354,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"catalog_service_delivery_status_dev","table_status":"ACTIVE","table_size_bytes":163980,"creation_date_time":"2022-06-14T21:44:37.960999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":5,"write_capacity_units":5,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3Mjk","href":"/catalog/infrastructure/1057729","name":"catalog_service_delivery_status_qa","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:987654321234:table/catalog_service_delivery_status_qa","type":"db_instance","region":"us-east-1","table_id":"93fc3c1b-4117-4eb4-89e9-9983299c990e","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"qa"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"}],"table_arn":"arn:aws:dynamodb:us-east-1:987654321234:table/catalog_service_delivery_status_qa","item_count":2106,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"catalog_service_delivery_status_qa","table_status":"ACTIVE","table_size_bytes":939617,"creation_date_time":"2022-06-14T21:48:50.858999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":5,"write_capacity_units":5,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc0MTY","href":"/catalog/infrastructure/1897416","name":"catalog-service-production-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:534832178741:db:catalog-service-production-1","type":"db_instance","engine":"aurora-postgresql","db_name":"catalog_service","endpoint":{"port":5432,"address":"catalog-service-production-1.crzttm68ambj.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"},{"key":"Name","value":"catalog-service-production-1"}],"kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"12.01","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:534832178741:db:catalog-service-production-1","db_subnet_group":{"vpc_id":"vpc-034eafe32072f52df","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-023bad4e8320252e8","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-067cbf2f7375865bc","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0ef78f3701c2d4a13","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"catalog-service-production-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster catalog-service-production"},"dbi_resource_id":"db-R6NQ25N3I2FRDDO7CUMUGHQ7XM","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1b","db_instance_class":"db.r6g.xlarge","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::534832178741:role/rds-enhanced-monitoring-catalog-service-production","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-018e00dcbb693e39b"}],"dedicated_log_volume":false,"instance_create_time":"2020-11-12T19:07:48.539999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"catalog-service-production","db_instance_identifier":"catalog-service-production-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":true,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:534832178741:log-group:RDSOSMetrics:log-stream:db-R6NQ25N3I2FRDDO7CUMUGHQ7XM","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[],"performance_insights_retention_period":7},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc0MTg","href":"/catalog/infrastructure/1897418","name":"catalog-service-production-2","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:534832178741:db:catalog-service-production-2","type":"db_instance","engine":"aurora-postgresql","db_name":"catalog_service","endpoint":{"port":5432,"address":"catalog-service-production-2.crzttm68ambj.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"},{"key":"Name","value":"catalog-service-production-2"}],"kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"12.01","promotion_tier":2,"db_instance_arn":"arn:aws:rds:us-east-1:534832178741:db:catalog-service-production-2","db_subnet_group":{"vpc_id":"vpc-034eafe32072f52df","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-023bad4e8320252e8","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-067cbf2f7375865bc","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0ef78f3701c2d4a13","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"catalog-service-production-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster catalog-service-production"},"dbi_resource_id":"db-FVQ7CQ4L4KWDILKPHIVYIJRGW4","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1c","db_instance_class":"db.r6g.xlarge","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::534832178741:role/rds-enhanced-monitoring-catalog-service-production","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-018e00dcbb693e39b"}],"dedicated_log_volume":false,"instance_create_time":"2020-11-12T18:59:02.134999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"catalog-service-production","db_instance_identifier":"catalog-service-production-2","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":true,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:534832178741:key/52c2d7e2-c69e-4e6f-a03b-aa5a10a687cb","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:534832178741:log-group:RDSOSMetrics:log-stream:db-FVQ7CQ4L4KWDILKPHIVYIJRGW4","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[],"performance_insights_retention_period":7},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzE4OTc1Njk","href":"/catalog/infrastructure/1897569","name":"catalog_service_delivery_status_production","type":"Database","rawData":{"arn":"arn:aws:dynamodb:us-east-1:534832178741:table/catalog_service_delivery_status_production","type":"db_instance","region":"us-east-1","table_id":"6494fa8e-384c-4a09-84b9-cba150f71851","tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"100"},{"key":"Environment","value":"production"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"}],"table_arn":"arn:aws:dynamodb:us-east-1:534832178741:table/catalog_service_delivery_status_production","item_count":13689848,"key_schema":[{"key_type":"HASH","attribute_name":"gandalfId"},{"key_type":"RANGE","attribute_name":"timestamp"}],"table_name":"catalog_service_delivery_status_production","table_status":"ACTIVE","table_size_bytes":6099950005,"creation_date_time":"2022-07-27T13:49:45.273999+00:00","attribute_definitions":[{"attribute_name":"gandalfId","attribute_type":"S"},{"attribute_name":"timestamp","attribute_type":"N"}],"provisioned_throughput":{"read_capacity_units":10,"write_capacity_units":10,"number_of_decreases_today":0},"deletion_protection_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvRW50aXR5T2JqZWN0LzEwNTc3MDc","href":"/catalog/infrastructure/1057707","name":"catalog-service-qa-1","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-qa-1","type":"db_instance","engine":"aurora-postgresql","db_name":"catalog_service","endpoint":{"port":5432,"address":"catalog-service-qa-1.ck8i1mnqeulo.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM61AM"},"multi_az":false,"tag_list":[{"key":"Project","value":"Partnerships"},{"key":"ManagedBy","value":"terraform"},{"key":"CostCenter","value":"engineering"},{"key":"Accounting","value":"200"},{"key":"Environment","value":"qa"},{"key":"Application","value":"ShoppingCart"},{"key":"AppName","value":"catalog-service"},{"key":"Name","value":"catalog-service-qa-1"}],"kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","network_type":"IPV4","storage_type":"aurora","backup_target":"region","license_model":"postgresql-license","engine_version":"12.01","promotion_tier":1,"db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-qa-1","db_subnet_group":{"vpc_id":"vpc-0b28432c3a2a8bcc2","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0e01fd24af2db80b7","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-0d56d3c9c73f08ac4","subnet_availability_zone":{"name":"us-east-1b"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-04e8659eceb5a4362","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"catalog-service-qa-aurora-postgresql","db_subnet_group_description":"Subnet
    Group for aurora-postgresql cluster catalog-service-qa"},"dbi_resource_id":"db-G74VR43FATYYWNRXFABLQUQMYY","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":1,"availability_zone":"us-east-1a","db_instance_class":"db.t4g.medium","storage_encrypted":true,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"default.aurora-postgresql11"}],"deletion_protection":false,"monitoring_interval":10,"monitoring_role_arn":"arn:aws:iam::987654321234:role/rds-enhanced-monitoring-catalog-service-qa","publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-041077de84466ebd7"}],"dedicated_log_volume":false,"instance_create_time":"2023-12-04T20:09:22.687999Z","copy_tags_to_snapshot":false,"db_cluster_identifier":"catalog-service-qa","db_instance_identifier":"catalog-service-qa-1","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:00-06:00","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:aurora-postgresql-11"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:10:00-mon:11:00","enabled_cloudwatch_logs_exports":["postgresql"],"performance_insights_kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/bda7cdc0-8f2f-435a-a5cc-4bb6e8cbe508","enhanced_monitoring_resource_arn":"arn:aws:logs:us-east-1:987654321234:log-group:RDSOSMetrics:log-stream:db-G74VR43FATYYWNRXFABLQUQMYY","iam_database_authentication_enabled":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"}]}}]'
  sampleQueryParams: alias[]=service1&alias[]=service2
  notes: Postgres 11 has entered into extended support.  This means every database
    instance which still is running on PG11 costs us an additional ~137/mo.  This
    is per instance, not per cluster.  This cost is 3x the cost of the actual instance
    in many cases; for example all of the t3.mediums running in dev/qa.
