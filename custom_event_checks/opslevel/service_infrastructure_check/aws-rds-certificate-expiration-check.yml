---
version: 1
kind: generic
spec:
  name: AWS RDS Certificate Expiration Check
  serviceSelector: ".[] | .aliases[0]"
  successCondition: '[.[] | select(.aliases | any(. == $ctx.alias)) | .relatedResources.nodes[]
    | select(.type == "Database") | .rawData | (.ca_certificate_identifier == "rds-ca-rsa2048-g1"
    or .ca_certificate_identifier == "rds-ca-rsa4096-g1" or .ca_certificate_identifier
    == "rds-ca-ecc384-g1")]| all'
  message: |-
    {% if check.passed %}
      ### Check passed

    Service **{{ctx.alias}}** has all databases up to date.

    {% for service in data %}
    {% if service.aliases[0] == ctx.alias %}
    {% for infra in service.relatedResources.nodes %}
    {% if infra != empty %}
    {% if infra.type == "Database" %}
    Infrastructure Resource: **{{ infra.name }}**
    * ca_certifate_identifier: {{ infra.rawData["ca_certificate_identifier"] }}
    * http://app.opslevel.com{{ infra.href }}
    {% endif %}
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endfor %}

    {% else %}
      ### Check failed
      Service **{{ ctx.alias }}** has failed. Please see the list of infrastructure resources below and update databases that still have `rds-ca-2019`. The correct certificate is `rds-ca-rsa2048-g1`

    {% for service in data %}
    {% if service.aliases[0] == ctx.alias %}
    {% for infra in service.relatedResources.nodes %}
    {% if infra != empty %}
    {% if infra.type == "Database" and infra.rawData["ca_certificate_identifier"] == "rds-ca-2019" %}
    Infrastructure Resource: **{{ infra.name }}**
    * ca_certifate_identifier: {{ infra.rawData["ca_certificate_identifier"] }}
    * http://app.opslevel.com{{ infra.href }}
    {% endif %}
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endfor %}

    {% endif %}
  samplePayload: '[{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA3Mg","name":"shopping-cart","aliases":["shopping-cart"],"relatedResources":{"nodes":[{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2Mw","href":"/catalog/infrastructure/212502","name":"shopping-cart-staging","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-staging","type":"db_instance","engine":"mysql","db_name":"app","endpoint":{"port":3306,"address":"shopping-cart-staging.ckqm9qycfvmh.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"Network-access","value":"private"},{"key":"Owner","value":"ianroy@gandalfs.com"},{"key":"Email","value":"ianroy@gandalfs.com"},{"key":"EnvironmentName","value":"shopping-cart-staging"},{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Project","value":"shopping-cart"},{"key":"Type","value":"rds"},{"key":"EnvironmentType","value":"staging"},{"key":"Network-role","value":"be"},{"key":"Environment","value":"staging"},{"key":"aws:cloudformation:logical-id","value":"MyDB"},{"key":"Component","value":"rds"}],"network_type":"IPV4","storage_type":"gp2","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-staging","db_subnet_group":{"vpc_id":"vpc-0931136c","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-2cd8a45b","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5218a279","subnet_availability_zone":{"name":"us-east-1c"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-920c9fcb","subnet_availability_zone":{"name":"us-east-1a"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-rdssubnetgroup-126yyw15gj85y","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-WEZJ4KTNNUEHPUM72OOFL4PLWE","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":5,"availability_zone":"us-east-1d","db_instance_class":"db.t2.micro","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"rds-pg-mysql8-shopping-cart-staging"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-caa7f0ae"}],"dedicated_log_volume":false,"instance_create_time":"2018-02-07T12:54:32.619999Z","copy_tags_to_snapshot":false,"activity_stream_status":"stopped","db_instance_identifier":"shopping-cart-staging","backup_retention_period":0,"pending_modified_values":{},"preferred_backup_window":"04:52-05:22","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"sun:09:57-sun:10:27","iam_database_authentication_enabled":false,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2Mg","href":"/catalog/infrastructure/212503","name":"shopping-cart","type":"File
    Storage","rawData":{"arn":"arn:aws:s3:::shopping-cart","name":"shopping-cart","location":"us-east-1","tag_list":[{"key":"Network-access","value":"private"},{"key":"Project","value":"shopping-cart"},{"key":"Owner","value":"microservices"},{"key":"Type","value":"bucket"},{"key":"Email","value":"_microservices_platform@gandalfs.com"},{"key":"Network-role","value":"med"},{"key":"Environment","value":"lab"},{"key":"Component","value":"s3"},{"key":"Name","value":"shopping-cart"}],"versioning":null,"policy_status":null},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2MQ","href":"/catalog/infrastructure/212504","name":"shopping-cart-prod","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-prod","iops":1000,"type":"db_instance","engine":"mysql","db_name":"app","endpoint":{"port":3306,"address":"shopping-cart-prod.cmxm7rqg0a8j.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":true,"tag_list":[{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Network-access","value":"private"},{"key":"Project","value":"shopping-cart"},{"key":"Owner","value":"_PlatformInfra@gandalfs.com"},{"key":"Type","value":"rds"},{"key":"Email","value":"_PlatformInfra@gandalfs.com"},{"key":"Network-role","value":"be"},{"key":"Environment","value":"production"},{"key":"Component","value":"rds"},{"key":"Name","value":"shopping-cart-prod"}],"network_type":"IPV4","storage_type":"io1","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:shopping-cart-prod","db_subnet_group":{"vpc_id":"vpc-448b7320","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-91a8f2c8","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-bd6c6fca","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5a602971","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-stack-az3-rdssubnetgroup-7wxhzy6wmony","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-MTVIQM7YVL4VW3BMJ7B54WRDUY","master_username":"root","associated_roles":[],"db_instance_port":0,"allocated_storage":100,"availability_zone":"us-east-1d","db_instance_class":"db.m5.large","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"rds-pg-mysql8-shopping-cart-prod"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-e170c998"}],"dedicated_log_volume":false,"instance_create_time":"2016-12-22T11:36:28.198000Z","copy_tags_to_snapshot":true,"activity_stream_status":"stopped","db_instance_identifier":"shopping-cart-prod","latest_restorable_time":"2024-07-22T23:50:00.000000Z","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"00:00-00:30","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":true,"secondary_availability_zone":"us-east-1c","performance_insights_enabled":true,"preferred_maintenance_window":"sun:08:05-sun:09:05","performance_insights_kms_key_id":"arn:aws:kms:us-east-1:987654321234:key/70f479af-6be6-4fc1-8d94-71511001f525","iam_database_authentication_enabled":false,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[],"performance_insights_retention_period":7},"__typename":"InfrastructureResource"}]}},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA1OQ","name":"catalog-service","aliases":["catalog-service"],"relatedResources":{"nodes":[{},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2Ng","href":"/catalog/infrastructure/212505","name":"catalog-service-staging-rds","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-staging-rds","type":"db_instance","engine":"mysql","endpoint":{"port":3306,"address":"catalog-service-staging-rds.ckqm9qycfvmh.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"Project","value":"catalog-service"},{"key":"Environment","value":"staging"},{"key":"Owner","value":"testinginfra"},{"key":"Email","value":"testinginfra_support@gandalfs.com"},{"key":"Name","value":"catalog-service-staging-rds"}],"network_type":"IPV4","storage_type":"gp2","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-staging-rds","db_subnet_group":{"vpc_id":"vpc-0931136c","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-2cd8a45b","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5218a279","subnet_availability_zone":{"name":"us-east-1c"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-920c9fcb","subnet_availability_zone":{"name":"us-east-1a"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-rdssubnetgroup-126yyw15gj85y","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-HZYN352Z2QWBWS4FAWZQHBAYAU","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":10,"availability_zone":"us-east-1c","db_instance_class":"db.t2.micro","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2025-07-11T05:41:03.000000Z","ca_identifier":"rds-ca-rsa2048-g1"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"catalog-service-staging-rds-pg-mysql80"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-caa7f0ae"}],"dedicated_log_volume":false,"instance_create_time":"2022-11-08T10:41:27.348999Z","copy_tags_to_snapshot":true,"activity_stream_status":"stopped","db_instance_identifier":"catalog-service-staging-rds","backup_retention_period":0,"pending_modified_values":{},"preferred_backup_window":"10:08-10:38","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-rsa2048-g1","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:06:00-mon:08:00","iam_database_authentication_enabled":true,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA1OA","href":"/catalog/infrastructure/212506","name":"catalog-service-prod-rds","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-prod-rds","type":"db_instance","engine":"mysql","endpoint":{"port":3306,"address":"catalog-service-prod-rds.cmxm7rqg0a8j.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"Project","value":"catalog-service"},{"key":"Environment","value":"prod"},{"key":"Owner","value":"testinginfra"},{"key":"Email","value":"testinginfra_support@gandalfs.com"},{"key":"Name","value":"catalog-service-prod-rds"}],"network_type":"IPV4","storage_type":"gp2","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:catalog-service-prod-rds","db_subnet_group":{"vpc_id":"vpc-448b7320","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-91a8f2c8","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-bd6c6fca","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5a602971","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-stack-az3-rdssubnetgroup-7wxhzy6wmony","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-BM6ZTGQ2MT447X3HMFVDPJZNVA","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":10,"availability_zone":"us-east-1c","db_instance_class":"db.m5.large","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2025-03-12T07:56:35.000000Z","ca_identifier":"rds-ca-rsa2048-g1"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"catalog-service-prod-rds-pg-mysql80"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-e170c998"}],"dedicated_log_volume":false,"instance_create_time":"2024-03-12T07:58:28.705999Z","copy_tags_to_snapshot":true,"activity_stream_status":"stopped","db_instance_identifier":"catalog-service-prod-rds","latest_restorable_time":"2024-07-22T23:50:00.000000Z","backup_retention_period":7,"pending_modified_values":{"db_instance_class":"db.m7g.large"},"preferred_backup_window":"09:56-10:26","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-rsa2048-g1","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"mon:06:00-mon:08:00","iam_database_authentication_enabled":true,"is_storage_config_upgrade_available":false,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"}]}},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2Nw","name":"website-aggregator","aliases":["website-aggregator"],"relatedResources":{"nodes":[]}},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2NA","name":"support-console","aliases":["support-console"],"relatedResources":{"nodes":[{},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2NQ","href":"/catalog/infrastructure/212507","name":"support-console-lab","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-lab","type":"db_instance","engine":"mysql","db_name":"app","endpoint":{"port":3306,"address":"support-console-lab.ckqm9qycfvmh.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"Project","value":"support-console"},{"key":"Owner","value":"ianroy@gandalfs.com"},{"key":"EnvironmentType","value":"staging"},{"key":"EnvironmentName","value":"support-console-lab"},{"key":"aws:cloudformation:logical-id","value":"MyDB"},{"key":"Name","value":"support-console-lab-mysql"}],"network_type":"IPV4","storage_type":"gp2","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-lab","db_subnet_group":{"vpc_id":"vpc-0931136c","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-2cd8a45b","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5218a279","subnet_availability_zone":{"name":"us-east-1c"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-920c9fcb","subnet_availability_zone":{"name":"us-east-1a"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-rdssubnetgroup-126yyw15gj85y","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-BDL5MIWGMV7ANBECO6TAPP5V7A","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":5,"availability_zone":"us-east-1d","db_instance_class":"db.t2.micro","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":0,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"rds-pg-mysql8-support-console-staging"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-caa7f0ae"}],"dedicated_log_volume":false,"instance_create_time":"2021-08-25T08:13:10.451999Z","copy_tags_to_snapshot":false,"activity_stream_status":"stopped","db_instance_identifier":"support-console-lab","backup_retention_period":0,"pending_modified_values":{},"preferred_backup_window":"09:36-10:06","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"tue:04:16-tue:04:46","iam_database_authentication_enabled":false,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA1Nw","href":"/catalog/infrastructure/212508","name":"support-console-b9a180","type":"Cache","rawData":{"arn":"arn:aws:elasticache:us-east-1:987654321234:cluster:support-console-b9a180","type":"cache_cluster","engine":"redis","tag_list":[{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Project","value":"support-console"},{"key":"Owner","value":"toddg@gandalfs.com"},{"key":"EnvironmentType","value":"staging"},{"key":"EnvironmentName","value":"support-console-tmp"},{"key":"Name","value":"support-console-tmp-redis"}],"cache_nodes":[{"endpoint":{"port":6379,"address":"support-console-b9a180.vniiqq.0001.use1.cache.amazonaws.com"},"cache_node_id":"0001","cache_node_status":"available","cache_node_create_time":"2021-10-03T12:12:54.320999Z","parameter_group_status":"in-sync","customer_availability_zone":"us-east-1d"}],"ip_discovery":"ipv4","network_type":"ipv4","engine_version":"5.0.6","cache_node_type":"cache.t2.micro","num_cache_nodes":1,"security_groups":[{"status":"active","security_group_id":"sg-9ae2afe7"}],"snapshot_window":"10:00-11:00","cache_cluster_id":"support-console-b9a180","auth_token_enabled":false,"cache_cluster_status":"available","cache_parameter_group":{"parameter_apply_status":"in-sync","cache_node_ids_to_reboot":[],"cache_parameter_group_name":"micro-redis-lzo1ybrahuv3"},"cache_security_groups":[],"cache_subnet_group_name":"lab-cache-vpc","pending_modified_values":{},"snapshot_retention_limit":0,"cache_cluster_create_time":"2021-10-03T12:12:54.320999Z","at_rest_encryption_enabled":false,"auto_minor_version_upgrade":false,"transit_encryption_enabled":false,"log_delivery_configurations":[],"preferred_availability_zone":"us-east-1d","client_download_landing_page":"https://console.aws.amazon.com/elasticache/home#client-download:","preferred_maintenance_window":"sun:08:30-sun:09:30","replication_group_log_delivery_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA2MA","href":"/catalog/infrastructure/212509","name":"gandalfs-lab-support-console","type":"File
    Storage","rawData":{"arn":"arn:aws:s3:::gandalfs-lab-support-console","name":"gandalfs-lab-support-console","location":"us-east-1","tag_list":[{"key":"Project","value":"support-console"},{"key":"Owner","value":"Order
    Management Team"},{"key":"email","value":"toddg@gandalfs.com"},{"key":"Name","value":"support-console"}],"versioning":null,"policy_status":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA3Mw","href":"/catalog/infrastructure/212894","name":"support-console-staging","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-staging","type":"db_instance","engine":"mysql","db_name":"app","endpoint":{"port":3306,"address":"support-console-staging.ckqm9qycfvmh.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Project","value":"support-console"},{"key":"Owner","value":"ianroy@gandalfs.com"},{"key":"EnvironmentType","value":"staging"},{"key":"EnvironmentName","value":"support-console-staging"},{"key":"aws:cloudformation:logical-id","value":"MyDB"},{"key":"Name","value":"support-console-staging-mysql"}],"network_type":"IPV4","storage_type":"gp2","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-staging","db_subnet_group":{"vpc_id":"vpc-0931136c","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-2cd8a45b","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5218a279","subnet_availability_zone":{"name":"us-east-1c"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-920c9fcb","subnet_availability_zone":{"name":"us-east-1a"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-rdssubnetgroup-126yyw15gj85y","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-IOAXFW7XR3B4IDI4W2D3MROZYY","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":5,"availability_zone":"us-east-1a","db_instance_class":"db.t3.medium","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"rds-pg-mysql8-support-console-staging"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-caa7f0ae"}],"dedicated_log_volume":false,"instance_create_time":"2021-06-21T22:31:56.363000Z","copy_tags_to_snapshot":true,"activity_stream_status":"stopped","db_instance_identifier":"support-console-staging","latest_restorable_time":"2024-07-23T00:10:00.000000Z","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:57-05:27","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"fri:03:11-fri:03:41","iam_database_authentication_enabled":false,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA1Mg","href":"/catalog/infrastructure/212895","name":"support-console-prod","type":"Database","rawData":{"arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-prod","iops":3000,"type":"db_instance","engine":"mysql","db_name":"app","endpoint":{"port":3306,"address":"support-console-prod.cmxm7rqg0a8j.us-east-1.rds.amazonaws.com","hosted_zone_id":"Z2R2ITUGPM69AN"},"multi_az":false,"tag_list":[{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Project","value":"support-console"},{"key":"Owner","value":"ianroy@gandalfs.com"},{"key":"EnvironmentType","value":"production"},{"key":"EnvironmentName","value":"support-console-prod"},{"key":"aws:cloudformation:logical-id","value":"MyDB"},{"key":"Name","value":"support-console-prod-mysql"}],"network_type":"IPV4","storage_type":"gp3","backup_target":"region","license_model":"general-public-license","engine_version":"8.0.35","db_instance_arn":"arn:aws:rds:us-east-1:987654321234:db:support-console-prod","db_subnet_group":{"vpc_id":"vpc-448b7320","subnets":[{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-91a8f2c8","subnet_availability_zone":{"name":"us-east-1a"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-bd6c6fca","subnet_availability_zone":{"name":"us-east-1d"}},{"subnet_status":"Active","subnet_outpost":{},"subnet_identifier":"subnet-5a602971","subnet_availability_zone":{"name":"us-east-1c"}}],"subnet_group_status":"Complete","db_subnet_group_name":"networking-stack-az3-rdssubnetgroup-7wxhzy6wmony","db_subnet_group_description":"gandalfs
    RDS subnet group"},"dbi_resource_id":"db-LHALLK5N3IJBB5FPXBZWD7HQFE","master_username":"gandalfsadmin","associated_roles":[],"db_instance_port":0,"allocated_storage":20,"availability_zone":"us-east-1a","db_instance_class":"db.m5.large","storage_encrypted":false,"db_instance_status":"available","db_security_groups":[],"domain_memberships":[],"storage_throughput":125,"certificate_details":{"valid_till":"2024-08-22T17:08:50.000000Z","ca_identifier":"rds-ca-2019"},"db_parameter_groups":[{"parameter_apply_status":"in-sync","db_parameter_group_name":"rds-pg-mysql8-support-console-production"}],"deletion_protection":false,"monitoring_interval":0,"publicly_accessible":false,"vpc_security_groups":[{"status":"active","vpc_security_group_id":"sg-e170c998"}],"dedicated_log_volume":false,"instance_create_time":"2021-06-21T22:52:51.355000Z","copy_tags_to_snapshot":true,"activity_stream_status":"stopped","db_instance_identifier":"support-console-prod","latest_restorable_time":"2024-07-22T23:50:00.000000Z","backup_retention_period":7,"pending_modified_values":{},"preferred_backup_window":"04:38-05:08","engine_lifecycle_support":"open-source-rds-extended-support","option_group_memberships":[{"status":"in-sync","option_group_name":"default:mysql-8-0"}],"ca_certificate_identifier":"rds-ca-2019","customer_owned_ip_enabled":false,"auto_minor_version_upgrade":false,"performance_insights_enabled":false,"preferred_maintenance_window":"sun:09:10-sun:10:10","iam_database_authentication_enabled":false,"is_storage_config_upgrade_available":true,"read_replica_db_instance_identifiers":[]},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82MzA3Nw","href":"/catalog/infrastructure/212896","name":"support-console-8b39e0","type":"Cache","rawData":{"arn":"arn:aws:elasticache:us-east-1:987654321234:cluster:support-console-8b39e0","type":"cache_cluster","engine":"redis","tag_list":[{"key":"map-migrated","value":"d-server-02t63lhhzjjhmb"},{"key":"Project","value":"support-console"},{"key":"Owner","value":"toddg@gandalfs.com"},{"key":"EnvironmentType","value":"production"},{"key":"EnvironmentName","value":"support-console-tmp"},{"key":"Name","value":"support-console-tmp-redis"}],"cache_nodes":[{"endpoint":{"port":6379,"address":"support-console-8b39e0.z8urkj.0001.use1.cache.amazonaws.com"},"cache_node_id":"0001","cache_node_status":"available","cache_node_create_time":"2021-10-03T12:38:56.803999Z","parameter_group_status":"in-sync","customer_availability_zone":"us-east-1d"}],"ip_discovery":"ipv4","network_type":"ipv4","engine_version":"5.0.6","cache_node_type":"cache.t2.small","num_cache_nodes":1,"security_groups":[{"status":"active","security_group_id":"sg-ed70c994"},{"status":"active","security_group_id":"sg-a86929d5"},{"status":"active","security_group_id":"sg-e370c99a"}],"snapshot_window":"08:00-09:00","cache_cluster_id":"support-console-8b39e0","auth_token_enabled":false,"cache_cluster_status":"available","cache_parameter_group":{"parameter_apply_status":"in-sync","cache_node_ids_to_reboot":[],"cache_parameter_group_name":"micro-redis-zq0rjj19z9fz"},"cache_security_groups":[],"cache_subnet_group_name":"prod-cache-vpc","pending_modified_values":{},"snapshot_retention_limit":0,"cache_cluster_create_time":"2021-10-03T12:38:56.803999Z","at_rest_encryption_enabled":false,"auto_minor_version_upgrade":false,"transit_encryption_enabled":false,"log_delivery_configurations":[],"preferred_availability_zone":"us-east-1d","client_download_landing_page":"https://console.aws.amazon.com/elasticache/home#client-download:","preferred_maintenance_window":"sun:09:00-sun:10:00","replication_group_log_delivery_enabled":false},"__typename":"InfrastructureResource"},{"id":"Z2lkOi8vb3BzbGV2ZWwvU2VydmljZS82Mjk2Mw","href":"/catalog/infrastructure/213111","name":"gandalfs-prod-support-console","type":"File
    Storage","rawData":{"arn":"arn:aws:s3:::gandalfs-prod-support-console","name":"gandalfs-prod-support-console","location":"us-east-1","tag_list":[{"key":"Project","value":"support-console"},{"key":"Owner","value":"Order
    Management Team"},{"key":"email","value":"toddg@gandalfs.com"},{"key":"Name","value":"support-console"}],"versioning":null,"policy_status":false},"__typename":"InfrastructureResource"}]}}]'
  sampleQueryParams: alias[]=service1&alias[]=service2
  notes: |-
    AWS is going to deprecate the existing *RDS* certificate we are currently using, `rds-ca-2019`, on **August 22, 2024**.

    In order to comply and be prepared for this change it is required to update your RDS's certificates from `rds-ca-2019` to any of the certificates below in the coming month:

    * `rds-ca-rsa2048-g1` (RSA 2048)
    * `rds-ca-rsa4096-g1` (RSA 4096)
    * `rds-ca-ecc384-g1` (ECC 384)

    More information on these certificates can be found here: https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html#UsingWithRDS.SSL.RegionCertificateAuthorities
